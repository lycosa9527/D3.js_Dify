<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Tree Map Test - MindGraph</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            color: #1976d2;
            margin-top: 0;
        }
        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background-color: #1565c0;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        #d3-container {
            border: 2px solid #ddd;
            border-radius: 5px;
            min-height: 400px;
            margin: 20px 0;
            background-color: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loading {
            color: #666;
            font-style: italic;
        }
        .console-log {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .module-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        .module-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            text-align: center;
        }
        .module-loaded { background-color: #d4edda; border-color: #c3e6cb; }
        .module-missing { background-color: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå≥ Clean Tree Map Test - MindGraph</h1>
        
        <div class="test-section">
            <h3>üìã Test Information</h3>
            <p>This is a <strong>clean tree map test</strong> that only loads the required modules:</p>
            <ul>
                <li><strong>theme-config.js</strong> - Theme configuration</li>
                <li><strong>style-manager.js</strong> - Style management</li>
                <li><strong>shared-utilities.js</strong> - Common utility functions</li>
                <li><strong>tree-renderer.js</strong> - Tree map rendering</li>
                <li><strong>renderer-dispatcher.js</strong> - Renderer routing</li>
            </ul>
            <p><em>No other renderers are loaded - this prevents JavaScript conflicts!</em></p>
        </div>

        <div class="test-section">
            <h3>üöÄ Module Loading Test</h3>
            <button onclick="testModuleLoading()">Test Module Loading</button>
            <button onclick="clearConsole()">Clear Console</button>
            <p><strong>Module Paths:</strong></p>
            <ul style="font-size: 12px; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                <li><code>theme-config.js</code> ‚Üí <code>/static/js/theme-config.js</code></li>
                <li><code>style-manager.js</code> ‚Üí <code>/static/js/style-manager.js</code></li>
                <li><code>shared-utilities.js</code> ‚Üí <code>/static/js/renderers/shared-utilities.js</code></li>
                <li><code>tree-renderer.js</code> ‚Üí <code>/static/js/renderers/tree-renderer.js</code></li>
                <li><code>renderer-dispatcher.js</code> ‚Üí <code>/static/js/renderers/renderer-dispatcher.js</code></li>
            </ul>
            <div id="module-status" class="module-status"></div>
            <div id="console-output" class="console-log"></div>
        </div>

        <div class="test-section">
            <h3>üå≥ Tree Map Rendering Test</h3>
            <button onclick="testTreeMapRendering()">Test Tree Map Rendering</button>
            <button onclick="testCustomTreeMap()">Test Custom Tree Map</button>
            <button onclick="clearContainer()">Clear Container</button>
            <div id="d3-container">
                <div class="loading">Click a test button to start rendering...</div>
            </div>
        </div>

        <div class="test-section">
            <h3>üîç Function Availability Check</h3>
            <button onclick="checkFunctionAvailability()">Check Functions</button>
            <div id="function-status"></div>
        </div>

        <div class="test-section">
            <h3>üìä Test Data</h3>
            <p>Using sample tree map data for testing:</p>
            <pre id="test-data" style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto;"></pre>
        </div>
    </div>

    <!-- Load D3.js first -->
    <script src="/static/js/d3.min.js"></script>
    
    <script>
        // Sample tree map data for testing
        const testTreeMapData = {
            topic: "Electric Tools",
            children: [
                {
                    label: "Power Tools",
                    children: [
                        { label: "Drills" },
                        { label: "Saws" },
                        { label: "Sanders" }
                    ]
                },
                {
                    label: "Hand Tools",
                    children: [
                        { label: "Screwdrivers" },
                        { label: "Pliers" },
                        { label: "Wrenches" }
                    ]
                },
                {
                    label: "Garden Tools",
                    children: [
                        { label: "Lawn Mowers" },
                        { label: "Trimmers" },
                        { label: "Hedge Cutters" }
                    ]
                }
            ]
        };

        // Display test data
        document.getElementById('test-data').textContent = JSON.stringify(testTreeMapData, null, 2);

        // Console logging function
        function log(message, type = 'info') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: ${type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#007bff'};">${message}</span>`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollTop + 1000;
            console.log(message);
        }

        // Clear console
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // Clear container
        function clearContainer() {
            document.getElementById('d3-container').innerHTML = '<div class="loading">Container cleared. Click a test button to start rendering...</div>';
        }

        // Test module loading
        function testModuleLoading() {
            log('üîÑ Starting module loading test...', 'info');
            
            const modules = [
                { name: 'theme-config', path: '/static/js/theme-config.js' },
                { name: 'style-manager', path: '/static/js/style-manager.js' },
                { name: 'shared-utilities', path: '/static/js/renderers/shared-utilities.js' },
                { name: 'tree-renderer', path: '/static/js/renderers/tree-renderer.js' },
                { name: 'renderer-dispatcher', path: '/static/js/renderers/renderer-dispatcher.js' }
            ];
            
            const moduleStatus = document.getElementById('module-status');
            moduleStatus.innerHTML = '';
            
            modules.forEach(module => {
                const moduleItem = document.createElement('div');
                moduleItem.className = 'module-item module-missing';
                moduleItem.setAttribute('data-module', module.name);
                moduleItem.innerHTML = `<strong>${module.name}</strong><br><span>Loading...</span>`;
                moduleStatus.appendChild(moduleItem);
            });
            
            // Load modules in sequence
            loadModulesSequentially(modules, 0);
        }

        // Load modules sequentially to prevent conflicts
        function loadModulesSequentially(modules, index) {
            if (index >= modules.length) {
                log('‚úÖ All modules loaded successfully!', 'success');
                updateModuleStatus(modules.map(m => m.name), 'loaded');
                return;
            }
            
            const module = modules[index];
            log(`üì¶ Loading module: ${module.name} from ${module.path}`, 'info');
            
            const script = document.createElement('script');
            script.src = module.path;
            script.onload = function() {
                log(`‚úÖ ${module.name} loaded successfully`, 'success');
                updateModuleStatus([module.name], 'loaded');
                // Load next module
                setTimeout(() => loadModulesSequentially(modules, index + 1), 100);
            };
            script.onerror = function() {
                log(`‚ùå Failed to load ${module.name} from ${module.path}`, 'error');
                updateModuleStatus([module.name], 'missing');
                // Continue with next module
                setTimeout(() => loadModulesSequentially(modules, index + 1), 100);
            };
            document.head.appendChild(script);
        }

        // Update module status display
        function updateModuleStatus(modules, status) {
            const moduleStatus = document.getElementById('module-status');
            modules.forEach(moduleName => {
                const moduleItem = moduleStatus.querySelector(`[data-module="${moduleName}"]`);
                if (moduleItem) {
                    moduleItem.className = `module-item module-${status}`;
                    moduleItem.querySelector('span').textContent = status === 'loaded' ? 'Loaded' : 'Missing';
                }
            });
        }

        // Test tree map rendering
        function testTreeMapRendering() {
            log('üå≥ Testing tree map rendering...', 'info');
            
            if (typeof renderTreeMap === 'undefined') {
                log('‚ùå renderTreeMap function not found. Load modules first.', 'error');
                return;
            }
            
            try {
                renderTreeMap(testTreeMapData);
                log('‚úÖ Tree map rendered successfully!', 'success');
            } catch (error) {
                log(`‚ùå Tree map rendering failed: ${error.message}`, 'error');
            }
        }

        // Test custom tree map
        function testCustomTreeMap() {
            log('üé® Testing custom tree map...', 'info');
            
            if (typeof renderTreeMap === 'undefined') {
                log('‚ùå renderTreeMap function not found. Load modules first.', 'error');
                return;
            }
            
            const customData = {
                topic: "Software Development",
                children: [
                    {
                        label: "Frontend",
                        children: [
                            { label: "React" },
                            { label: "Vue" },
                            { label: "Angular" }
                        ]
                    },
                    {
                        label: "Backend",
                        children: [
                            { label: "Node.js" },
                            { label: "Python" },
                            { label: "Java" }
                        ]
                    }
                ]
            };
            
            try {
                renderTreeMap(customData);
                log('‚úÖ Custom tree map rendered successfully!', 'success');
            } catch (error) {
                log(`‚ùå Custom tree map rendering failed: ${error.message}`, 'error');
            }
        }

        // Check function availability
        function checkFunctionAvailability() {
            log('üîç Checking function availability...', 'info');
            
            const functions = {
                'renderTreeMap': typeof renderTreeMap,
                'TreeRenderer': typeof TreeRenderer,
                'MindGraphUtils': typeof MindGraphUtils,
                'addWatermark': typeof addWatermark,
                'styleManager': typeof styleManager,
                'renderGraph': typeof renderGraph
            };
            
            const functionStatus = document.getElementById('function-status');
            functionStatus.innerHTML = '';
            
            Object.entries(functions).forEach(([funcName, funcType]) => {
                const statusDiv = document.createElement('div');
                statusDiv.className = `status ${funcType === 'function' ? 'success' : funcType === 'object' ? 'info' : 'error'}`;
                statusDiv.innerHTML = `<strong>${funcName}:</strong> ${funcType === 'undefined' ? 'Not Available' : funcType}`;
                functionStatus.appendChild(statusDiv);
            });
            
            log('‚úÖ Function availability check completed', 'success');
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Clean Tree Map Test page loaded', 'success');
            log('üí° Click "Test Module Loading" to start testing', 'info');
        });
    </script>
</body>
</html>
